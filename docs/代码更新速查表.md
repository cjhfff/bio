# ä»£ç æ›´æ–°é€ŸæŸ¥è¡¨

å¿«é€Ÿå‚è€ƒï¼šç”Ÿäº§ç¯å¢ƒä»£ç æ›´æ–°å¸¸ç”¨å‘½ä»¤ã€‚è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ [ç”Ÿäº§ç¯å¢ƒä»£ç æ›´æ–°æŒ‡å—](./ç”Ÿäº§ç¯å¢ƒä»£ç æ›´æ–°æŒ‡å—.md)ã€‚

## ğŸš€ å¿«é€Ÿæ›´æ–°æµç¨‹

```bash
# 1. å®‰å…¨æ£€æŸ¥
./scripts/check_update_safety.sh

# 2. å¤‡ä»½æ•°æ®
cp data/paper_push.db data/paper_push.db.backup.$(date +%Y%m%d_%H%M%S)
cp .env .env.backup.$(date +%Y%m%d_%H%M%S)

# 3. åœæ­¢æœåŠ¡ï¼ˆé€‰æ‹©ä¸€ç§ï¼‰
sudo systemctl stop paper-push.timer  # systemd
# æˆ–ç­‰å¾… crontab ä»»åŠ¡å®Œæˆ

# 4. æ›´æ–°ä»£ç 
git fetch origin && git pull origin main

# 5. æ›´æ–°ä¾èµ–ï¼ˆå¦‚æœ requirements.txt æœ‰å˜åŒ–ï¼‰
source venv/bin/activate
pip install -r requirements.txt

# 6. æµ‹è¯•éªŒè¯
python -m backend test-sources

# 7. å¯åŠ¨æœåŠ¡
sudo systemctl start paper-push.timer  # systemd

# 8. ç›‘æ§æ—¥å¿—
tail -f logs/paper_push_*.log
```

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤

### æ£€æŸ¥çŠ¶æ€

```bash
# æŸ¥çœ‹è¿è¡Œè¿›ç¨‹
ps aux | grep python | grep backend

# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡
crontab -l
sudo systemctl status paper-push.timer

# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -50 logs/paper_push_*.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR logs/paper_push_*.log
```

### å¤‡ä»½æ“ä½œ

```bash
# å¤‡ä»½æ•°æ®åº“
cp data/paper_push.db data/paper_push.db.backup.$(date +%Y%m%d_%H%M%S)

# å¤‡ä»½æ•´ä¸ªé¡¹ç›®
cd /path/to
tar -czf bio_backup_$(date +%Y%m%d_%H%M%S).tar.gz bio/

# æŸ¥çœ‹å¤‡ä»½
ls -lh data/*.backup.*
```

### Git æ“ä½œ

```bash
# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
git log -1 --oneline

# æŸ¥çœ‹å¾…æ›´æ–°å†…å®¹
git fetch origin
git log HEAD..origin/main --oneline

# æŸ¥çœ‹æ–‡ä»¶å˜åŒ–
git diff HEAD..origin/main

# æ›´æ–°ä»£ç 
git pull origin main

# æŸ¥çœ‹æœ¬åœ°ä¿®æ”¹
git status
git diff
```

### ä¾èµ–ç®¡ç†

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# æŸ¥çœ‹å·²å®‰è£…çš„åŒ…
pip list

# æŸ¥çœ‹è¿‡æœŸçš„åŒ…
pip list --outdated
```

### æœåŠ¡æ§åˆ¶

```bash
# Systemd æ–¹å¼
sudo systemctl start paper-push.timer
sudo systemctl stop paper-push.timer
sudo systemctl restart paper-push.timer
sudo systemctl status paper-push.timer

# æŸ¥çœ‹ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´
sudo systemctl list-timers | grep paper-push

# Crontab æ–¹å¼
crontab -l  # æŸ¥çœ‹
crontab -e  # ç¼–è¾‘
```

### æµ‹è¯•éªŒè¯

```bash
# æµ‹è¯•æ•°æ®æº
python -m backend test-sources

# æµ‹è¯•ç‰¹å®šæ•°æ®æº
python -m backend test-sources --source biorxiv

# æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡
python -m backend run

# æŸ¥çœ‹å¸®åŠ©
python -m backend --help
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/paper_push_*.log

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
tail -100 logs/paper_push_*.log

# æŸ¥çœ‹é”™è¯¯
grep -i error logs/paper_push_*.log

# æŸ¥çœ‹è­¦å‘Š
grep -i warning logs/paper_push_*.log

# ç»Ÿè®¡é”™è¯¯æ•°é‡
grep -c ERROR logs/paper_push_*.log
```

### æ•°æ®åº“æ“ä½œ

```bash
# è¿æ¥æ•°æ®åº“
sqlite3 data/paper_push.db

# æŸ¥çœ‹è¡¨ç»“æ„
sqlite3 data/paper_push.db ".schema"

# æŸ¥çœ‹è®ºæ–‡æ•°é‡
sqlite3 data/paper_push.db "SELECT COUNT(*) FROM papers;"

# æŸ¥çœ‹æœ€è¿‘è¿è¡Œè®°å½•
sqlite3 data/paper_push.db "SELECT id, start_time, status, papers_count FROM runs ORDER BY start_time DESC LIMIT 5;"

# é€€å‡º
.quit
```

## ğŸ”™ å¿«é€Ÿå›æ»š

```bash
# Git å›æ»š
git log --oneline -10  # æ‰¾åˆ°è¦å›æ»šçš„ç‰ˆæœ¬
git reset --hard <commit-hash>

# æˆ–ä½¿ç”¨å¤‡ä»½æ¢å¤
cp data/paper_push.db.backup.YYYYMMDD_HHMMSS data/paper_push.db
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç¦æ­¢æ“ä½œ

- âŒ **ä¸è¦åˆ é™¤** `data/` ç›®å½•
- âŒ **ä¸è¦åˆ é™¤** `logs/` ç›®å½•  
- âŒ **ä¸è¦åˆ é™¤** `reports/` ç›®å½•
- âŒ **ä¸è¦è¦†ç›–** `.env` æ–‡ä»¶
- âŒ **ä¸è¦åœ¨ä»»åŠ¡è¿è¡Œæ—¶æ›´æ–°**

### å¿…é¡»æ“ä½œ

- âœ… **æ›´æ–°å‰å¤‡ä»½**æ•°æ®åº“å’Œé…ç½®
- âœ… **åœæ­¢æœåŠ¡**å†æ›´æ–°ä»£ç 
- âœ… **æµ‹è¯•éªŒè¯**æ›´æ–°åçš„åŠŸèƒ½
- âœ… **ç›‘æ§æ—¥å¿—**ç¡®è®¤æ­£å¸¸è¿è¡Œ

## ğŸ†˜ ç´§æ€¥æƒ…å†µ

### æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# 1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -100 logs/paper_push_*.log

# 2. æ£€æŸ¥è¿›ç¨‹
ps aux | grep python

# 3. æ£€æŸ¥é…ç½®
cat .env

# 4. æµ‹è¯•æ•°æ®æº
python -m backend test-sources
```

### æ•°æ®åº“é”™è¯¯

```bash
# 1. æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
ls -lh data/paper_push.db*

# 2. æ¢å¤å¤‡ä»½
cp data/paper_push.db.backup.æœ€æ–° data/paper_push.db

# 3. æ£€æŸ¥æƒé™
chmod 644 data/paper_push.db
```

### ä»£ç å†²çª

```bash
# 1. æŸ¥çœ‹å†²çªæ–‡ä»¶
git status

# 2. æ”¾å¼ƒæœ¬åœ°ä¿®æ”¹
git checkout -- <file>

# 3. æˆ–ä¿å­˜æœ¬åœ°ä¿®æ”¹åæ›´æ–°
git stash
git pull
git stash pop
```

## ğŸ“ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜æ—¶ï¼š

1. æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š[ç”Ÿäº§ç¯å¢ƒä»£ç æ›´æ–°æŒ‡å—](./ç”Ÿäº§ç¯å¢ƒä»£ç æ›´æ–°æŒ‡å—.md)
2. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`logs/paper_push_*.log`
3. è¿è¡Œè¯Šæ–­è„šæœ¬ï¼š`./scripts/check_update_safety.sh`
4. æŸ¥çœ‹éƒ¨ç½²æŒ‡å—ï¼š[æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—](./æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md)
