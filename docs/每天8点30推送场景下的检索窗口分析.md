# 每天8:30推送场景下的检索窗口分析

## 当前配置

- **推送时间**: 每天早上8:30
- **检索窗口**: 1天
- **检索逻辑**: `start_date = today - 1天` 到 `today`

## 检索窗口的实际含义

当 `window_days = 1` 时：
- **PubMed**: 检索 `[昨天日期]` 到 `[今天日期]` 之间发布的论文
- **EuropePMC**: 检索 `FIRST_PDATE:[昨天日期] TO [今天日期]`
- **bioRxiv**: 检索 `[昨天日期]` 到 `[今天日期]` 之间发布的论文

**注意**: 这是按**日期**计算的，不是按**时间点**计算的。

## 在每天8:30推送场景下的分析

### 场景1：论文在昨天发布
- **昨天8:30之后发布的论文**: ✅ 今天8:30运行时会检索到
- **昨天8:30之前发布的论文**: ✅ 昨天8:30运行时已经检索过了

### 场景2：论文在今天发布
- **今天8:30之前发布的论文**: 
  - 如果已经被索引 → ✅ 今天8:30运行时会检索到
  - 如果还没被索引 → ❌ 今天检索不到，但明天会检索到
- **今天8:30之后发布的论文**: 
  - 今天8:30运行时还没发布 → ❌ 今天检索不到
  - 明天8:30运行时应该能检索到（如果已被索引）

### 场景3：索引延迟
- **论文发布但未及时索引**: 
  - 如果延迟1-2天 → ❌ 可能漏掉
  - 但由于每天都会运行，明天应该能检索到

## 1天窗口是否足够？

### ✅ 足够的理由

1. **每天都会运行**: 
   - 即使今天漏掉，明天也能检索到
   - 不会永久漏掉论文

2. **日期范围覆盖**: 
   - 1天窗口覆盖"昨天+今天"的论文
   - 对于每天运行来说，这个范围是合理的

3. **避免重复**: 
   - 如果窗口太大（如3天），可能会重复检索很多论文
   - 1天窗口可以避免重复

### ⚠️ 潜在风险

1. **索引延迟**: 
   - 如果论文发布后需要1-2天才被索引，可能会漏掉
   - 但由于每天运行，明天应该能检索到

2. **时区差异**: 
   - 不同数据源可能使用不同时区
   - 可能导致边界情况下的漏检

3. **更新频率**: 
   - 不同数据源的更新频率不同
   - 某些数据源可能不是实时更新

## 结论

**在每天8:30推送的场景下，1天窗口基本足够，但存在以下情况：**

### 不需要改的情况：
- ✅ 如果论文发布后能在1天内被索引
- ✅ 如果数据源更新频率较高
- ✅ 如果时区问题不严重

### 可能需要改的情况：
- ⚠️ 如果发现经常漏掉重要论文（说明索引延迟严重）
- ⚠️ 如果EuropePMC等数据源经常返回0篇（说明查询可能过严）
- ⚠️ 如果发现论文发布后需要2-3天才被索引

## 建议

### 当前配置（1天窗口）可以保持不变，如果：
1. 没有发现明显的漏检问题
2. 每天运行能稳定检索到相关论文
3. 数据源更新频率正常

### 考虑改为2天窗口，如果：
1. 发现经常漏掉重要论文
2. 数据源索引延迟明显（1-2天）
3. EuropePMC等数据源经常返回0篇结果

### 更好的方案：
- **保持1天窗口**，但添加**容错机制**：
  - 如果某天检索到的论文数量异常少（如<5篇），自动扩展到2天窗口
  - 或者使用"最近N天"而不是"昨天到今天"

## 实际建议

**基于你的场景（每天8:30推送），1天窗口应该是足够的**，因为：
1. 每天都会运行，不会永久漏掉论文
2. 即使今天漏掉，明天也能检索到
3. 1天窗口可以避免重复检索

**但如果发现以下情况，可以考虑改为2天窗口：**
- EuropePMC经常返回0篇（说明查询可能过严）
- 发现明显漏掉重要论文
- 数据源索引延迟明显

