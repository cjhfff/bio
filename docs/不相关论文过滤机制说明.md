# 不相关论文过滤机制说明

## 工作原理

系统通过AI判断论文是否属于三大研究方向，如果不属于，则自动过滤，不会出现在最终报告中，也不会推送给用户。

## 过滤流程

### 1. AI判断阶段（`app/llm/generator.py`）

在 `generate_single_paper_report()` 函数中，每篇论文都会被发送给AI进行分析。提示词中明确要求：

```
**重要：如果论文不属于三大研究方向（生物固氮、胞外信号感知与传递、酶的结构与作用机制），请返回以下格式：**
  ## 不相关论文
  
  此论文不属于指定的三大研究方向，已自动过滤。
```

如果AI判断论文不属于三大方向，会返回特殊标记 `## 不相关论文`。

### 2. 过滤检查阶段（`app/cli.py`）

在处理每篇论文的报告时，系统会检查：

```python
# 检查是否是不相关论文
is_irrelevant = paper_report and paper_report.startswith("## 不相关论文")

if is_irrelevant:
    # 不相关论文，跳过不添加到报告中
    logger.info(f"⏭️ 论文 {paper_idx} 不属于三大研究方向，已自动过滤")
    continue  # 关键：使用 continue 跳过，不添加到 all_paper_reports
```

**关键点**：
- 使用 `continue` 语句跳过不相关论文
- 不相关论文**不会**被添加到 `all_paper_reports` 列表中
- 因此不会出现在最终报告中

### 3. 最终报告生成

最终报告只包含 `all_paper_reports` 中的论文，不相关论文已经被过滤掉：

```python
# 直接拼接所有论文报告
daily_report = "\n\n".join([f"## 论文 {i+1} 重要研究成果\n\n{report}" 
                            for i, report in enumerate(all_paper_reports)])
```

## 示例

### 日志中的记录

```
2025-12-30 19:07:21 - app.cli - INFO - ⏭️ 论文 1 不属于三大研究方向，已自动过滤
2025-12-30 19:07:33 - app.cli - INFO - ✅ 论文 2 处理成功（AI分析完成）
2025-12-30 19:07:38 - app.cli - INFO - ⏭️ 论文 3 不属于三大研究方向，已自动过滤
```

### 结果

- **论文1、3**：被AI判断为不相关，使用 `continue` 跳过，不添加到报告
- **论文2**：属于三大方向，添加到 `all_paper_reports`，最终出现在报告中

## 优势

1. **自动化**：无需人工判断，AI自动识别
2. **精准**：基于论文内容进行判断，而非简单的关键词匹配
3. **透明**：日志中清晰记录哪些论文被过滤
4. **高效**：不相关论文不会占用报告空间，也不会推送给用户

## 注意事项

- AI判断可能存在误判（将相关论文判断为不相关，或反之）
- 如果发现重要论文被误过滤，可以查看日志确认
- 被过滤的论文不会标记为"已推送"，下次运行时会重新处理

